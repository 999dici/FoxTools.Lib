/*! Хитрая (клиентская) библиотека для работы с не менее Хитрым API v2.0
* http://api.foxtools.ru/v2
* http://foxtools.ru
*
* Версия библиотеки: 1.0-beta (2 мая 2015 года)
* ----------------------------------------------------------------------------
* Copyright (c) Aleksey Nemiro, 2015. All rights reserved.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* ----------------------------------------------------------------------------
*/
function fox(n,t){return new foxtools.lib(n,t)}var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},foxtools;(function(n){function et(n,t){return new e(n,t)}var r=function(){function n(){}return n.tokenCookieName="foxtoken",n.requestBaseUrl="{0}://api.foxtools.ru/v2/{1}",n.useSsl=!1,n}(),f,i,e,s,l,tt,a,v,u,h,c,y,p,o,w,b,k,d,it,rt,g,ut,nt,t,ot,st,ft,ht;n.config=r;f=function(){function n(){this.token=null}return n}();n.requestProcess=f;i=function(){function n(n){if(this.messages=[],this.trace=[],n===undefined||n===null||n==="")throw new Error("Type is required.");this.type=n}return n.prototype.addTrace=function(n,t){this.trace.push(new p(n,t))},n.prototype.addMessage=function(n,t){this.messages.push(new y(n,t))},n}();n.baseResult=i;n.api=et;e=function(){function n(n,t){var i=this;$(n).length>0&&$(n).each(function(){this.tagName.toLowerCase()=="form"?$(this).submit(function(){t=t||new f;var n=new l(this);return n.token=t.token,n.complete=t.complete,n.begin=t.begin,n.uploading=t.uploading,$(this).data("begin")!==undefined&&$(this).data("begin")!==""&&typeof window[$(this).data("begin")]=="function"&&(n.begin=window[$(this).data("begin")]),$(this).data("complete")!==undefined&&$(this).data("complete")!==""&&typeof window[$(this).data("complete")]=="function"&&(n.complete=window[$(this).data("complete")]),$(this).data("token")!==undefined&&$(this).data("token")!==""&&(n.token=$(this).data("token")),n.submit(),!1}):console.log("WARNING: Expected a form tag.")})}return n.prototype.getToken=function(n,i){var u=null;if(typeof n=="object"&&(i===undefined&&i===null?i=n:$.extend(i,n),n=i.url),i=i||{},!(u=t.readCookies(r.tokenCookieName))){if(n===undefined||n===null)return console.log("Url is empty. No way to get a new token..."),u;$.ajax({type:i.type||"POST",enctype:i.enctype||"application/x-www-form-urlencoded",url:n,success:function(n){typeof n=="object"&&(n=n.token!==undefined&&n.token!==null&&typeof n.token=="string"?n.token:n.value!==undefined&&n.value!==null&&typeof n.value=="string"?n.value:n.data!==undefined&&n.data!==null&&typeof n.data=="string"?n.data:n[Object.keys(n)[0]]);t.createCookies(r.tokenCookieName,n);i.complete!==undefined&&i.complete!==null&&typeof i.complete=="function"&&i.complete(new o(n))},error:function(n,t,r){i.complete!==undefined&&i.complete!==null&&typeof i.complete=="function"?i.complete(new h(new c(0,t+": "+r))):console.log(t+": "+r)}})}return u},n.ready=function(){t.initYa()},n}();n.lib=e;s=function(){function n(n,t,i){this.request=null;this.token=null;this.cancel=!1;this.data=null;this.request=n;this.token=t;this.data=i}return n}();n.beginRequest=s;l=function(n){function i(t){n.call(this);this.form=null;this.form=t}return __extends(i,n),i.prototype.submit=function(){var i=this,n=t.parseToken(i.token);n!==null&&n.url!==null&&n.value===null&&(n.value=t.readCookies(r.tokenCookieName));n!==null&&n.url!==null&&n.value===null?(new e).getToken(n.url,{type:i.token.type,enctype:i.token.enctype,complete:function(t){if(t.type=="errorResult")throw new Error(t.getText());else n.value=t.value,i.justSubmit(n)}}):i.justSubmit(n)},i.prototype.justSubmit=function(n){var i=this,v=i.form,e=$(i.form),o=null,c=e.attr("method")||"GET",h,a,f,l;if($("input[type=file]",v).length>0&&(c="POST",o="multipart/form-data"),c.toUpperCase()!="POST"||o||(o="application/x-www-form-urlencoded"),h=null,h=c.toUpperCase()=="POST"&&o=="multipart/form-data"?new FormData(v):e.serialize(),a=null,n!==null&&n.value!==null&&n.value!=""&&(a={Authorization:"Bearer "+n.value}),f=$(e.attr("action").split("/")).last()[0].toString(),f=f.indexOf("?")!=-1?f.substr(0,f.indexOf("?")):f,i.begin!==undefined&&i.begin!==null&&typeof i.begin=="function"){if(l=new s(i,n,h),i.begin(l),l.cancel)return;h=l.data}t.yah(e.attr("action"),f);$.ajax({type:c,enctype:o,url:e.attr("action"),data:h,dataType:"json",headers:a,xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(n){n.lengthComputable&&i.uploading!==undefined&&i.uploading!==null&&typeof i.uploading=="function"&&i.uploading(Math.round(n.loaded*100/n.total),n.loaded,n.total)},!1),n},beforeSend:function(){e.removeData("completed");e.data("sending","true")},success:function(n){i.complete!==undefined&&i.complete!==null&&typeof i.complete=="function"?i.complete(new u(f,200,null,n)):new u(f,200,null,n)},error:function(e,o,s){var h=new u(f,e.status,s,$.parseJSON(e.responseText||s));if(h.data.type=="errorResult"&&$.grep(h.data.items,function(n){return n.code==1110||n.code==1111||n.code==1112}).length>0&&n.url!==null&&n.errors==0){t.eraseCookies(r.tokenCookieName);i.token={url:n.url,errors:n.errors+1};i.submit();return}i.complete!==undefined&&i.complete!==null&&typeof i.complete=="function"&&i.complete(h)},complete:function(){e.removeData("sending");e.data("completed","true")},cache:!1,processData:!1,contentType:!1})},i}(f);n.formRequest=l;tt=function(n){function i(i){if(n.call(this),this.baseUrl=r.requestBaseUrl,this.useSsl=r.useSsl,this.type="GET",this.endpoint="",this.methodName="",i===undefined||i===null)throw new Error("Method name is required. Please add method name to request:\r\nYou can find a list of methods on the page: http://api.foxtools.ru/v2");this.methodName=i;this.endpoint=t.format(this.baseUrl,[this.useSsl?"https":"http",i]);this.parameters=new a}return __extends(i,n),i.prototype.execute=function(){var i=this,n=t.parseToken(i.token);n!==null&&n.url!==null&&n.value===null&&(n.value=t.readCookies(r.tokenCookieName));n!==null&&n.url!==null&&n.value===null?(new e).getToken(n.url,{type:i.token.type,enctype:i.token.enctype,complete:function(t){if(t.type=="errorResult")throw new Error(t.getText());else n.value=t.value,i.justExecute(n)}}):i.justExecute(n)},i.prototype.justExecute=function(n){var i=this,f=null,e=i.type||"GET",c,o,h;if(i.parameters.hasFiles&&(e="POST",f="multipart/form-data"),e.toUpperCase()!="POST"||f||(f="application/x-www-form-urlencoded"),c=null,n!==null&&n.value!==null&&n.value!=""&&(c={Authorization:"Bearer "+n.value}),o=e=="GET"?$.param(i.parameters.toParams()):i.parameters.toParams(),i.begin!==undefined&&i.begin!==null&&typeof i.begin=="function"){if(h=new s(i,n,o),i.begin(h),h.cancel)return;o=h.data}t.yah(i.endpoint,i.methodName);$.ajax({url:i.endpoint,enctype:f,type:e,headers:c,xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(n){n.lengthComputable&&i.uploading!==undefined&&i.uploading!==null&&typeof i.uploading=="function"&&i.uploading(Math.round(n.loaded*100/n.total),n.loaded,n.total)},!1),n},success:function(n){i.complete!==undefined&&i.complete!==null&&typeof i.complete=="function"?i.complete(new u(i.methodName,200,null,n)):new u(i.methodName,200,null,n)},error:function(f,e,o){var s=new u(i.methodName,f.status,o,$.parseJSON(f.responseText||o));if(s.data.type=="errorResult"&&$.grep(s.data.items,function(n){return n.code==1110||n.code==1111||n.code==1112}).length>0&&n.url!==null&&n.errors==0){t.eraseCookies(r.tokenCookieName);i.token={url:n.url,errors:n.errors+1};i.execute();return}i.complete!==undefined&&i.complete!==null&&typeof i.complete=="function"&&i.complete(s)},complete:function(){},data:o,cache:!1,contentType:!1,processData:!1})},i}(f);n.request=tt;a=function(){function n(){this.items=[]}return n.prototype.add=function(n,t){this.items.push(new v(n,t))},n.prototype.toParams=function(){for(var t=null,r=this.hasFiles,i,t=r?new FormData:{},n=0;n<=this.items.length-1;n++)if(r)if(this.items[n].isFile)if(this.items[n].value.length==1&&t.append(this.items[n].name,this.items[n].value[0]),this.items[n].value.length>1)for(i=0;i<=this.items[n].value.length-1;i++)t.append(this.items[n].name+"[]",this.items[n].value[i]);else t.append(this.items[n].name,null);else t.append(this.items[n].name,this.items[n].value);else t[this.items[n].name]=this.items[n].value;return t},Object.defineProperty(n.prototype,"hasFiles",{get:function(){return $.grep(this.items,function(n){if(n.isFile)return!0}).length>0},enumerable:!0,configurable:!0}),n}();n.httpParameterCollection=a;v=function(){function n(n,i){if(this.isFile=!1,n===undefined||n===null)throw new Error("Name is required.");if(t.isElement(n))this.name=$(n).attr("name"),this.setValue(n);else if(t.isJqueryObject(n))if(n.length)this.name=n.attr("name"),this.setValue(n);else throw new Error("jQuery object can not be empty.");else this.name=n,this.setValue(i)}return n.prototype.setValue=function(n){if(t.isElement(n))n=$(n);else if(t.isJqueryObject(n)){if(!n.length)throw new Error("jQuery object can not be empty.");}else{this.isFile=!1;this.value=n;return}n.is(":file")?(this.isFile=!0,this.value=n[0].files):(this.isFile=!1,this.value=n.val())},n}();n.httpParameter=v;u=function(){function n(n,t,i,r){var u;if(t===0?r.response.errors.items=[{code:0,text:"Not connect. Verify Network."}]:t==404?r.response.errors.items=[{code:0,text:"Requested page not found [HTTP404]."}]:i==="parsererror"?r.response.errors.items=[{code:0,text:"Requested JSON parse failed."}]:i==="timeout"?r.response.errors.items=[{code:0,text:"Timeout error."}]:i==="abort"&&(r.response.errors.items=[{code:0,text:"Ajax request aborted."}]),r!==undefined&&r!==null){if(this.methodName=n!==undefined&&n!==null?n.toLowerCase():"",typeof r=="object"){if(r.response===undefined||r.response===null)return;r=r.response}else{this.data=new o(r);return}if(r.errors!==undefined&&r.errors!==null)this.data=new h(r.errors);else switch(this.methodName){case"geoip":this.data=new d(r);break;case"hash":this.data=new b(r.items);break;case"proxy":this.data=new g(r);break;case"machinekey":case"stat":case"textdecoder":case"translator":case"weather":case"webconverter":case"eventlogger":this.data=r;break;case"pwd":case"guid":case"idn":case"randomkey":this.data=new w(r);break;default:this.data=new o(r.value)}if(r.messages!==undefined&&r.messages!==null)for(u=0;u<=r.messages.length-1;u++)this.data.addMessage(r.messages[u].type,r.messages[u].text);if(r.trace!==undefined&&r.trace!==null)for(u=0;u<=r.trace.length-1;u++)this.data.addTrace(r.trace[u].message,r.trace[u].elapsedTime)}}return Object.defineProperty(n.prototype,"isError",{get:function(){return this.data.type==="errorResult"},enumerable:!0,configurable:!0}),n.prototype.toString=function(){return this.data.toString()},n}();n.result=u;h=function(n){function t(t){if(n.call(this,"errorResult"),this.items=[],t!==undefined&&t!==null)for(var i=0;i<=t.length-1;i++)this.add(ft[t[i].code],t[i].text)}return __extends(t,n),t.prototype.add=function(n,t){this.items.push(new c(n,t))},t.prototype.toString=function(){return this.getText()},t.prototype.getText=function(){for(var n="",t=0;t<=this.items.length-1;t++)n.length>0&&(n+="\n"),n+=this.items[t].text;return n},t}(i);n.errorResult=h;c=function(){function n(n,t){this.code=n;this.text=t}return n}();n.errorMessage=c;y=function(){function n(n,t){this.type=n;this.text=t}return n}();n.messageItem=y;p=function(){function n(n,t){this.message=n;this.elapsedTime=t}return n.prototype.toString=function(){return this.elapsedTime+"> "+this.message},n}();n.traceItem=p;o=function(n){function t(t){n.call(this,"stringResult");this.value=t}return __extends(t,n),t.prototype.toString=function(){return this.value},t}(i);n.stringResult=o;w=function(n){function t(t){n.call(this,"stringArrayResult");this.items=[];this.pageNumber=0;this.pageCount=0;this.items=t.items;this.pageNumber=t.pageNumber;this.pageCount=t.pageCount}return __extends(t,n),t}(i);n.stringArrayResult=w;b=function(n){function t(t){if(n.call(this,"hashResult"),this.items=[],t!==undefined&&t!==null)for(var i=0;i<=t.length-1;i++)this.add(t[i].code,t[i].text)}return __extends(t,n),t.prototype.add=function(n,t){this.items.push(new k(n,t))},t}(i);n.hashResult=b;k=function(){function n(n,t){this.type=n;this.value=t}return n}();n.hashItem=k;d=function(n){function t(t){n.call(this,"ipResult");this.proxy=!1;this.country=null;this.city=null;this.ip=t.ip;this.proxy=t.proxy;this.country=t.country||null;this.city=t.city||null}return __extends(t,n),t}(i);n.ipResult=d;it=function(n){function t(){n.apply(this,arguments);this.nameEn=null;this.nameRu=null;this.domain=null;this.domainNational=null;this.fips10=null;this.id=null;this.ioc=null;this.iso3166a2=null;this.iso3166a3=null;this.iso3166num=null;this.itu=null;this.phoneCode=null;this.stanag=null;this.un=null;this.unIso=null}return __extends(t,n),t}(i);n.countryResult=it;rt=function(n){function t(){n.apply(this,arguments);this.nameEn=null;this.nameRu=null;this.zip=null;this.metroCode=null;this.areaCode=null;this.longitude=null;this.latitude=null}return __extends(t,n),t}(i);n.cityResult=rt;g=function(n){function t(t){if(n.call(this,"proxyResult"),this.pageNumber=0,this.pageCount=0,this.items=[],this.pageNumber=t.pageNumber,this.pageCount=t.pageCount,t.items!==undefined&&t.items!==null)for(var i=0;i<=t.items.length-1;i++)this.add(t.items[i])}return __extends(t,n),t.prototype.add=function(n){this.items.push(n)},t}(i);n.proxyResult=g;ut=function(){function n(){this.ip="";this.available=0;this.free=0;this.country=null}return n}();n.proxyItem=ut;nt=function(){function n(){this.value=null;this.url=null;this.errors=0}return n}();n.foxtoolsToken=nt;t=function(){function n(){}return n.format=function(n,t){return n===undefined||n===null||n===""?(console.log("Value is empty."),null):(t.length===1&&t[0]!==null&&typeof t[0]=="object"&&(t=t[0]),typeof t=="string"&&(t=[t]),n.replace(/{([^}]*)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n}))},n.createCookies=function(n,t,i){var u="",r=new Date;i!==undefined&&i!==null&&(r.setTime(r.getTime()+i*864e5),u="; expires="+r.toUTCString());document.cookie=this.format("{name}={value}{expires}; path=/",{name:n,value:t,expires:u})},n.readCookies=function(n){var r=document.cookie.split(";"),i,t;for(n=n+"=",i=0;i<r.length;i++){for(t=r[i];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(n)==0)return t.substring(n.length,t.length)}return null},n.eraseCookies=function(t){n.createCookies(t,"",-1)},n.isElement=function(n){return n===undefined||n===null?!1:n instanceof HTMLElement},n.isJqueryObject=function(n){return n===undefined||n===null?!1:n instanceof $},n.clinetIsSupportLocalStorage=function(){try{return"localStorage"in window&&window.localStorage!==null}catch(n){return!1}},n.parseToken=function(n){if(n===undefined||n===null)return null;var t=new nt;if(typeof n=="string")/^[0-9A-Fa-f]{32}$/.test(n)?t.value=n:t.url=n;else if(typeof n=="object"){if(n.value!==undefined&&n.value!==null&&n!=""&&(t.value=n.value),n.url!==undefined&&n.url!==null&&n.url!=""&&(t.url=n.url),n.errors!==undefined&&n.errors!==null&&(t.errors=n.errors),t.value===null&&t.url===null)throw new Error("Token not found.");}else throw new Error("Token value not supported.");return t},n.yah=function(t,i){try{n.yaCounter!==undefined&&n.yaCounter!==null&&n.yaCounter.hit(t,i,null)}catch(r){}},n.initYa=function(){try{window.Ya===undefined||window.Ya===null?$.getScript("//mc.yandex.ru/metrika/watch.js",function(){n.yaCounter=new window.Ya.Metrika({id:24654338,enableAll:!0})}):(n.yaCounter===undefined||n.yaCounter===null)&&(n.yaCounter=new window.Ya.Metrika({id:24654338,enableAll:!0}))}catch(t){}},n}();n.utility=t,function(n){n[n.auto=0]="auto";n[n.encode=1]="encode";n[n.decode=2]="decode"}(n.dataMode||(n.dataMode={}));ot=n.dataMode,function(n){n[n.text=0]="text";n[n.file=1]="file"}(n.outputFormat||(n.outputFormat={}));st=n.outputFormat,function(n){n[n.None=0]="None";n[n.InternalError=1e3]="InternalError";n[n.NotSupported=1001]="NotSupported";n[n.NotImplemented=1002]="NotImplemented";n[n.UnableToProcessData=1003]="UnableToProcessData";n[n.Timeout=1004]="Timeout";n[n.AccessDenied=1100]="AccessDenied";n[n.AccessTokenError=1110]="AccessTokenError";n[n.AccessTokenNotFound=1111]="AccessTokenNotFound";n[n.NoPermissionToUseTokenForCurrentIp=1112]="NoPermissionToUseTokenForCurrentIp";n[n.AddressIsBlacklisted=1121]="AddressIsBlacklisted";n[n.ArgumentNullOrEmpty=2001]="ArgumentNullOrEmpty";n[n.ArgumentOutOfRange=2002]="ArgumentOutOfRange";n[n.InvalidFormat=3001]="InvalidFormat";n[n.InvalidFileType=3002]="InvalidFileType";n[n.InvalidContentType=3003]="InvalidContentType";n[n.InvalidCast=3004]="InvalidCast";n[n.InvalidValue=3005]="InvalidValue";n[n.DataNotFound=3101]="DataNotFound";n[n.ContentTypeNotFound=3102]="ContentTypeNotFound";n[n.ExternalServiceIsNotAvailable=5e3]="ExternalServiceIsNotAvailable";n[n.ExternalServiceError=5001]="ExternalServiceError"}(n.errorCode||(n.errorCode={}));ft=n.errorCode,function(n){n[n.Any=0]="Any";n[n.Yes=1]="Yes";n[n.No=2]="No"}(n.yesNoAny||(n.yesNoAny={}));ht=n.yesNoAny})(foxtools||(foxtools={}));document.addEventListener?document.addEventListener("DOMContentLoaded",foxtools.lib.ready):document.attachEvent&&window.attachEvent("onload",foxtools.lib.ready);
//# sourceMappingURL=foxtools.lib.min.js.map
